// jrrToken - Tokenizer
//@author Steven Dufresne <steven@enserfud.ca>
//@link http://github.com/StevenDufresne/jrrToken
//@copyright 2013 Steven Dufresne
var jrrToken={init:function(e){e==undefined?e={}:e=e;jrrToken.tokenContainer=(typeof e.tokenContainer=="object"?e.tokenContainer.selector:e.tokenContainer)||$("[data-jrrToken]").selector,jrrToken.submitBtn=e.submitBtn||$("[data-jrrSubmit]"),jrrToken.inputID=e.inputID||$("[data-jrrInput]"),jrrToken.formID=e.formID||$("[data-jrrForm]"),jrrToken.clearBtn=e.clearBtn||$("[data-jrrClearBtn]"),jrrToken.$tokenContainer=$(jrrToken.tokenContainer);jrrToken.addEvents(jrrToken.tokenContainer);jrrToken.formID.append('<textarea name="finaldata" type="hidden" id="ttText" style="display: none;"></textarea>')},addEvents:function(){$(jrrToken.tokenContainer).on("click",function(){jrrToken.inputID.focus()});jrrToken.inputID.on("keydown",function(e){jrrToken.directData($(this),e)});jrrToken.inputID.on("paste",function(e){setTimeout(function(){jrrToken.displayItem(jrrToken.inputID,jrrToken.inputID.val().split(" "))},1)});$(document).on("click",function(){document.activeElement.id=="theInput"?jrrToken.$tokenContainer.addClass("inputChange"):jrrToken.$tokenContainer.removeClass("inputChange")});jrrToken.submitBtn.on("click",function(){jrrToken.collectInputItems()});if(jrrToken.clearBtn){jrrToken.clearBtn.on("click",this.removeAll)}},directData:function(e,t){if(t.keyCode===32){var n=e.val().replace(/\,/g,"").split(" ");jrrToken.displayItem(e,n);t.preventDefault()}else if(t.keyCode===8||t.keyCode===46){if(t.currentTarget.value===""){jrrToken.getItems().last().remove();jrrToken.collectDOMItems()}}},displayItem:function(e,t){var n=jrrToken,r=[];for(var i=0;i<t.length;i+=1){if(t[i]!=""){r.push(t[i]);var s=r[r.length-1];var o=$("<div data-val="+s+">"+s+"<span>&#10007;</span></div>");e.before(o);e.val("");o.on("click",function(){$(this).remove()})}}},getItems:function(){return $(jrrToken.tokenContainer).children("div")},removeAll:function(){var e=jrrToken.getItems(),t=e.length;for(var n=t;n>0;n--){$(e[n-1]).remove()}},collectInputItems:function(){var e=$(jrrToken.inputID).val();e!=""?jrrToken.collectDOMItems(e.split(" ")):jrrToken.collectDOMItems()},collectDOMItems:function(e){var t=jrrToken.getItems(),n=[],r=t.length;for(var i=0;i<r;i+=1){n.push($(t[i]).data("val"))}if(e!=undefined){for(var s=0;s<e.length;s++){n.push(e[s])}}jrrToken.outputData(n)},outputData:function(e){$("#ttText").val(e)}}